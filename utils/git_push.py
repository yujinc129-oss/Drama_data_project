# -*- coding: utf-8 -*-
"""git_push.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1xHNIcjP11FbviGXDtRbVWWTcDymvCY9i
"""

def git_push(file_path):
  # --- ì‚¬ìš©ì ì„¤ì • ---
  # 1. GitHub ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ì¡°ì§ ì´ë¦„
  # ì˜ˆ: "yujinc129-oss"
  GITHUB_USERNAME = "yujinc129-oss"

  # 2. ëŒ€ìƒ ì €ì¥ì†Œ(Repository) ì´ë¦„
  # ì˜ˆ: "Drama_data_project"
  REPO_NAME = "Drama_data_project"

  # 3. ì—…ë¡œë“œí•  íŒŒì¼ì´ ìˆëŠ” Colab ë‚´ ë¡œì»¬ ê²½ë¡œ
  # ì˜ˆ: "/content/my_processed_data.csv"
  # íŒŒì¼ì„ Colabì— ì—…ë¡œë“œí•˜ê±°ë‚˜, Colab ë‚´ì—ì„œ ìƒì„±í•œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
  COLAB_FILE_PATH = file_path # <--- ì—…ë¡œë“œí•  íŒŒì¼ ê²½ë¡œë¡œ ìˆ˜ì •í•˜ì„¸ìš”.

  # 4. íŒŒì¼ì´ ì—…ë¡œë“œë  GitHub ì €ì¥ì†Œ ë‚´ ê²½ë¡œ
  # ì˜ˆ: "data/processed/my_processed_data.csv"
  GITHUB_FILE_PATH = f"data/processed/{os.path.basename(COLAB_FILE_PATH)}"

  # 5. ì»¤ë°‹ ë©”ì‹œì§€
  COMMIT_MESSAGE = f"Add {os.path.basename(COLAB_FILE_PATH)} from Colab"
  # --------------------

  # Colab Secretsì—ì„œ GitHub í† í° ê°€ì ¸ì˜¤ê¸°
  try:
      GITHUB_TOKEN = userdata.get('GITHUB_TOKEN')
  except userdata.SecretNotFoundError:
      print("ğŸš¨ Colabì˜ 'ë¹„ë°€'ì— GITHUB_TOKENì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
      print("ì¢Œì¸¡ ğŸ”‘ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ GITHUB_TOKENì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.")
      raise

  # GitHub APIì— ì¸ì¦
  g = Github(GITHUB_TOKEN)

  try:
      # ì‚¬ìš©ì(ë˜ëŠ” ì¡°ì§) ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      user = g.get_user(GITHUB_USERNAME)

      # ì €ì¥ì†Œ(Repository) ê°ì²´ ê°€ì ¸ì˜¤ê¸°
      try:
          repo = user.get_repo(REPO_NAME)
      except GithubException:
          print(f"ğŸš¨ ì €ì¥ì†Œ '{REPO_NAME}'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
          print(f"'{GITHUB_USERNAME}' ì‚¬ìš©ìì—ê²Œ í•´ë‹¹ ì €ì¥ì†Œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
          raise

      # ì—…ë¡œë“œí•  íŒŒì¼ ë‚´ìš© ì½ê¸°
      try:
          with open(COLAB_FILE_PATH, 'rb') as file:
              content = file.read()
      except FileNotFoundError:
          print(f"ğŸš¨ Colab ê²½ë¡œì—ì„œ '{COLAB_FILE_PATH}' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
          print("íŒŒì¼ì´ í•´ë‹¹ ê²½ë¡œì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
          raise

      # íŒŒì¼ ì—…ë¡œë“œ (ë˜ëŠ” ì—…ë°ì´íŠ¸)
      try:
          # í•´ë‹¹ ê²½ë¡œì— íŒŒì¼ì´ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
          repo.get_contents(GITHUB_FILE_PATH)
          # íŒŒì¼ì´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
          repo.update_file(
              path=GITHUB_FILE_PATH,
              message=f"Update {os.path.basename(COLAB_FILE_PATH)} from Colab",
              content=content,
              sha=repo.get_contents(GITHUB_FILE_PATH).sha,
              branch="main" # ë˜ëŠ” ê¸°ë³¸ ë¸Œëœì¹˜ ì´ë¦„
          )
          print(f"âœ… íŒŒì¼ ì—…ë°ì´íŠ¸ ì„±ê³µ: '{GITHUB_FILE_PATH}'")

      except GithubException as e:
          if e.status == 404:
              # íŒŒì¼ì´ ì—†ë‹¤ë©´ ìƒˆë¡œ ìƒì„±
              repo.create_file(
                  path=GITHUB_FILE_PATH,
                  message=COMMIT_MESSAGE,
                  content=content,
                  branch="main" # ë˜ëŠ” ê¸°ë³¸ ë¸Œëœì¹˜ ì´ë¦„
              )
              print(f"âœ… íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ: '{GITHUB_FILE_PATH}'")
          else:
              print("ğŸš¨ íŒŒì¼ ì—…ë¡œë“œ/ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
              raise

  except GithubException as e:
      print(f"ğŸš¨ GitHub API ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
      print("- GitHub ì‚¬ìš©ì ì´ë¦„, ì €ì¥ì†Œ ì´ë¦„ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.")
      print("- ê°œì¸ ì•¡ì„¸ìŠ¤ í† í°ì˜ 'repo' ê¶Œí•œì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.")
  except Exception as e:
      print(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
